import { Request, Response } from 'express';
import { parse } from 'url';
import { TransItem, TransQuery, TransPage } from './data';

const transDataSource: TransItem[] = [
  {
    lsId: '1',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '2',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '3',
    merNo: '123456789012345',
    termNo: '12345678',

    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '4',
    merNo: '123456789012345',
    termNo: '12345678',

    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '5',
    merNo: '123456789012345',
    termNo: '12345678',

    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '6',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '7',
    merNo: '123456789012345',
    termNo: '12345678',

    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '8',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '9',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '10',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '11',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
  {
    lsId: '12',
    merNo: '123456789012345',
    termNo: '12345678',
    cardNo: '1233*********6789',
    tranAmt: 100,
    tranType: '01',
    respCode: '00',
    tranDate: '20200129',
    tranTime: '184530',
    batchNo: '',
    traceNo: '',
    authNo: '',
    rrn: '',
  },
];

function getTrans(req: Request, res: Response) {
  const params = (parse(req.url, true).query as unknown) as TransQuery & {
    size: number;
    page: number;
  };

  const dataSource = transDataSource
    .filter(data => params.termNo ? data.termNo.includes(params.termNo) : true);

  const page: TransPage = {
    content: dataSource,
    pageable: {
      pageSize: Number(params.size) || 10,
      pageNumber: Number(params.page) || 0,
      sort: [],
    },
    totalElements: dataSource.length,
    totalPages: dataSource.length % params.size,
  }

  return res.json(page);
}

export default {
  'GET /svc/msp/trans': getTrans,
};
